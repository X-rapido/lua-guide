## Lua æ•°æ®ç±»å‹

Lua æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå› æ­¤å˜é‡æ²¡æœ‰ç±»å‹ï¼Œåªæœ‰å€¼å…·æœ‰ç±»å‹ã€‚å€¼å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å¹¶ä½œä¸ºç»“æœè¿”å›ã€‚

### ä¸€ã€åŸºæœ¬ç±»å‹

| ç¼–å· | å€¼ç±»å‹     | æè¿°                                   |
| ---- | ---------- | -------------------------------------- |
| 1    | `nil`      | è¡¨ç¤ºä¸€ä¸ªæ— æ•ˆå€¼ã€‚                       |
| 2    | `boolean`  | åŒ…æ‹¬trueå’Œfalseä½œä¸ºå€¼                  |
| 3    | `number`   | è¡¨ç¤ºåŒç²¾åº¦ç±»å‹çš„å®æµ®ç‚¹æ•°ã€‚             |
| 4    | `string`   | å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤ºã€‚     |
| 5    | `function` | ç”± C æˆ– Lua ç¼–å†™çš„å‡½æ•°ã€‚               |
| 6    | `table`    | è¡¨ç¤ºæ™®é€šæ•°ç»„ï¼Œç¬¦å·è¡¨ï¼Œé›†åˆï¼Œè®°å½•ï¼Œå›¾å½¢ï¼Œæ ‘ç­‰ï¼Œå¹¶å®ç°å…³è”æ•°ç»„ã€‚å®ƒå¯ä»¥ä¿å­˜ä»»ä½•å€¼(é™¤äº†nil)ã€‚   |
| 7    | `thread`   | è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨äºæ‰§è¡ŒååŒç¨‹åºã€‚ |
| 8    | `userdata` | è¡¨ç¤ºä»»æ„å­˜å‚¨åœ¨å˜é‡ä¸­çš„Cæ•°æ®ç»“æ„ã€‚      |

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `type` å‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…å€¼çš„ç±»å‹ï¼š
```lua
print(type("Hello world"))      --> string
print(type(10.4*3))             --> number
print(type(print))              --> function
print(type(type))               --> function
print(type(true))               --> boolean
print(type(nil))                --> nil
print(type(type(X)))            --> string
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ†é…å€¼æˆ–åˆå§‹åŒ–ä¹‹å‰ï¼Œæ‰€æœ‰å˜é‡éƒ½å°†æŒ‡å‘ `nil`ã€‚åœ¨æ¡ä»¶æ£€æŸ¥çš„æƒ…å†µä¸‹ï¼Œé›¶å’Œç©ºå­—ç¬¦ä¸²è®¤ä¸ºæ˜¯ï¼š`trueã€‚` å› æ­¤ï¼Œä½¿ç”¨å¸ƒå°”è¿ç®—æ—¶å¿…é¡»å°å¿ƒã€‚

#### 1ã€nilï¼ˆç©ºï¼‰
`nil` ç±»å‹è¡¨ç¤ºä¸€ç§æ²¡æœ‰ä»»ä½•æœ‰æ•ˆå€¼ï¼Œå®ƒåªæœ‰ä¸€ä¸ªå€¼ï¼š`nil`ï¼Œä¾‹å¦‚æ‰“å°ä¸€ä¸ªæ²¡æœ‰èµ‹å€¼çš„å˜é‡ï¼Œä¾¿ä¼šè¾“å‡ºä¸€ä¸ª `nil` å€¼ï¼š

```lua
> print(type(a))
nil
>
```

å¯¹äºå…¨å±€å˜é‡å’Œ `table`ï¼Œnil è¿˜æœ‰ä¸€ä¸ª"åˆ é™¤"ä½œç”¨ï¼Œç»™å…¨å±€å˜é‡æˆ–è€… table è¡¨é‡Œçš„å˜é‡èµ‹ä¸€ä¸ª nil å€¼ï¼Œç­‰åŒäºæŠŠå®ƒä»¬åˆ æ‰ï¼Œå¦‚ä¸‹ï¼š
```lua
tab1 = { key1 = "val1", key2 = "val2", "val3" }
for k, v in pairs(tab1) do
    print(k .. " - " .. v)
end
 
tab1.key1 = nil
for k, v in pairs(tab1) do
    print(k .. " - " .. v)
end
```

**nuil ç±»å‹æ¯”è¾ƒ**

`nil` ä½œæ¯”è¾ƒæ—¶åº”è¯¥åŠ ä¸Šï¼šå•é“¶è¡Œ `'` æˆ–åŒå¼•å· `"`ã€‚
```lua
> type(X)
nil
> type(X) == nil
false
> type(X) == "nil"
true
>
```

è¿™æ˜¯å› ä¸º `type(X)==nil` ç»“æœä¸º `false` è€Œ `type(type(X))` çš„ç»“æœæ˜¯ `string`ã€‚

#### 2ã€booleanï¼ˆå¸ƒå°”ï¼‰
`boolean` ç±»å‹åªæœ‰ä¸¤ä¸ªå€¼ï¼š`true`ï¼ˆçœŸï¼‰ å’Œ `false`ï¼ˆå‡ï¼‰ï¼ŒLua æŠŠ `false` å’Œ `nil` çœ‹ä½œæ˜¯"å‡"ï¼Œå…¶ä»–çš„éƒ½ä¸º"çœŸ"ã€‚

```lua
print(type(true))
print(type(false))
print(type(nil))

if type(false) or type(nil) then
    print("false and nil are false!")
else
    print("other is true!")
end
```

ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š
```
boolean
boolean
nil
false and nil are false!
```

#### 3ã€numberï¼ˆæ•°å­—ï¼‰
Lua é»˜è®¤åªæœ‰ä¸€ç§ `number` ç±»å‹ï¼š`double`ï¼ˆåŒç²¾åº¦ï¼‰ç±»å‹ï¼ˆé»˜è®¤ç±»å‹å¯ä»¥ä¿®æ”¹ `luaconf.h` é‡Œçš„å®šä¹‰ï¼‰ï¼Œä»¥ä¸‹å‡ ç§å†™æ³•éƒ½è¢«çœ‹ä½œæ˜¯ number ç±»å‹ï¼š
```lua
print(type(2))
print(type(2.2))
print(type(0.2))
print(type(2e+1))
print(type(0.2e-1))
print(type(7.8263692594256e-06))
```

ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœéƒ½æ˜¯ï¼šnumber

#### 4ã€stringï¼ˆå­—ç¬¦ä¸²ï¼‰
å­—ç¬¦ä¸²ç”±ä¸€å¯¹åŒå¼•å·æˆ–å•å¼•å·æ¥è¡¨ç¤ºã€‚
```lua
string1 = "this is string1"
string2 = 'this is string2'
```

**å­—ç¬¦ä¸²å—**

ä¹Ÿå¯ä»¥ç”¨ 2 ä¸ªæ–¹æ‹¬å· `[[ ]]` æ¥è¡¨ç¤º"ä¸€å—"å­—ç¬¦ä¸²ã€‚
```lua
html = [[
<html>
<head></head>
<body>
    <a href="//www.ibloger.net/">ç¨‹åºå–µ</a>
</body>
</html>
]]

print(html)
```
ä»¥ä¸‹ä»£ç æ‰§è¡Œç»“æœä¸ºï¼š
```
<html>
<head></head>
<body>
    <a href="//www.ibloger.net/">ç¨‹åºå–µ</a>
</body>
</html>
```

**å­—ç¬¦ä¸²ç®—æœ¯è¿ç®—**

åœ¨å¯¹ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ä¸Šè¿›è¡Œç®—æœ¯æ“ä½œæ—¶ï¼ŒLua ä¼šå°è¯•å°†è¿™ä¸ªæ•°å­—å­—ç¬¦ä¸²è½¬æˆä¸€ä¸ªæ•°å­—ï¼Œè¿™ç‚¹åŒºåˆ†äºjavaä¹‹ç±»è¯­è¨€ã€‚

```lua
print("2" + 6)          --> 8.0
print("2" + "6")        --> 8.0
print("2 + 6")          --> 2 + 6
print("-2e2" * "6")     --> -1200.0
print("error" + 1)      --> input:5: attempt to perform arithmetic on a string value
```

**å­—ç¬¦ä¸²æ‹¼æ¥**

å­—ç¬¦ä¸²è¿æ¥ä½¿ç”¨çš„æ˜¯ `..` ï¼Œå¦‚ï¼š
```lua
print("a" .. 'b')       --> ab
print(157 .. 428)       --> 157428
```

**å­—ç¬¦ä¸²é•¿åº¦**

ä½¿ç”¨ `#` æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ”¾åœ¨å­—ç¬¦ä¸²å‰é¢ã€‚
- æ±‰å­—å ç”¨ 3 ä¸ªå­—ç¬¦é•¿åº¦
- è¡¨æƒ…ç¬¦å·å ç”¨ 4 ä¸ªå­—ç¬¦é•¿åº¦ã€‚

å¦‚ä¸‹å®ä¾‹ï¼š
```lua
len = "www.ibloger.net"    
print(#len)                 --> 15
print(#"å–µ")                --> 3
print(#"ç¨‹åºå–µ")             --> 9
print(#"ğŸ±")                --> 4
```

#### 5ã€tableï¼ˆè¡¨ï¼‰
åœ¨ Lua é‡Œ `table` çš„åˆ›å»ºæ˜¯é€šè¿‡"æ„é€ è¡¨è¾¾å¼"æ¥å®Œæˆï¼Œæœ€ç®€å•æ„é€ è¡¨è¾¾å¼æ˜¯`{}`ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºè¡¨ã€‚ä¹Ÿå¯ä»¥åœ¨è¡¨é‡Œæ·»åŠ ä¸€äº›æ•°æ®ï¼Œç›´æ¥åˆå§‹åŒ–è¡¨ã€‚
```lua
-- åˆ›å»ºä¸€ä¸ªç©ºçš„ table
local tbl1 = {}
 
-- ç›´æ¥åˆå§‹è¡¨
local tbl2 = {"apple", "pear", "orange", "grape"}
```

Lua ä¸­çš„è¡¨ï¼ˆtableï¼‰å…¶å®æ˜¯ä¸€ä¸ª"å…³è”æ•°ç»„"ï¼ˆassociative arraysï¼‰ï¼Œæ•°ç»„çš„ç´¢å¼•å¯ä»¥æ˜¯æ•°å­—æˆ–è€…æ˜¯å­—ç¬¦ä¸²ã€‚

```lua
a = {}
a["k"] = "v"
key = 10
a[key] = 22
a[key] = a[key] + 11

for k, v in pairs(a) do
    print(k .. " : " .. v)
end
```

è„šæœ¬æ‰§è¡Œç»“æœä¸ºï¼š
```
k : v
10 : 33
```

ä¸åŒäºå…¶ä»–è¯­è¨€çš„æ•°ç»„æŠŠ `0` ä½œä¸ºæ•°ç»„çš„åˆå§‹ç´¢å¼•ï¼Œåœ¨ Lua é‡Œè¡¨çš„é»˜è®¤åˆå§‹ç´¢å¼•æ˜¯ä»¥ `1` å¼€å§‹ã€‚
```lua
local tbl = {"apple", "pear", "orange", "grape"}

for key, val in pairs(tbl) do
    print("Key", key)
end
```

è„šæœ¬æ‰§è¡Œç»“æœä¸ºï¼š
```
Key	1
Key	2
Key	3
Key	4
```
table ä¸ä¼šå›ºå®šé•¿åº¦å¤§å°ï¼Œæœ‰æ–°æ•°æ®æ·»åŠ æ—¶ table é•¿åº¦ä¼šè‡ªåŠ¨å¢é•¿ï¼Œæ²¡åˆå§‹çš„ `table` éƒ½æ˜¯ `nil`ã€‚

**ç´¢å¼•**

Lua å¯¹ table çš„ç´¢å¼•ä½¿ç”¨æ–¹æ‹¬å· `[]`ã€‚ä¹Ÿæä¾›äº† `.` æ“ä½œã€‚
```lua
t[i]
t.i                 -- å½“ç´¢å¼•ä¸ºå­—ç¬¦ä¸²ç±»å‹æ—¶çš„ä¸€ç§ç®€åŒ–å†™æ³•
```

ä¾‹å¦‚ï¼š
```lua
site = {}
site["key"] = "www.ibloger.net"

print(site["key"])      --> www.ibloger.net
print(site.key)         --> www.ibloger.net
```

#### 6ã€functionï¼ˆå‡½æ•°ï¼‰
åœ¨ Lua ä¸­ï¼Œå‡½æ•°æ˜¯è¢«çœ‹ä½œæ˜¯"ç¬¬ä¸€ç±»å€¼ï¼ˆFirst-Class Valueï¼‰"ï¼Œå‡½æ•°å¯ä»¥å­˜åœ¨å˜é‡é‡Œã€‚
```lua
function factorial1(n)
    if n == 0 then
        return 1
    else
        return n * factorial1(n - 1)
    end
end

print(factorial1(5))             --> 120

factorial2 = factorial1
print(factorial2(5))             --> 120
```

`function` å¯ä»¥ä»¥åŒ¿åå‡½æ•°ï¼ˆanonymous functionï¼‰çš„æ–¹å¼é€šè¿‡å‚æ•°ä¼ é€’ã€‚
```lua
function anonymous(tab, fun)
    for k, v in pairs(tab) do
        print(fun(k, v))
    end
end

tab = { key1 = "val1", key2 = "val2" }

anonymous(tab, function(key, val)   -- function åŒ¿åå‡½æ•°
    return key .. " = " .. val
end)
```
è„šæœ¬æ‰§è¡Œç»“æœä¸ºï¼š
``` 
key1 = val1
key2 = val2
```

#### 7ã€threadï¼ˆçº¿ç¨‹ï¼‰
åœ¨ Lua é‡Œï¼Œæœ€ä¸»è¦çš„çº¿ç¨‹æ˜¯ååŒç¨‹åºï¼ˆcoroutineï¼‰ã€‚å®ƒè·Ÿçº¿ç¨‹ï¼ˆthreadï¼‰å·®ä¸å¤šï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆã€å±€éƒ¨å˜é‡å’ŒæŒ‡ä»¤æŒ‡é’ˆï¼Œå¯ä»¥è·Ÿå…¶ä»–ååŒç¨‹åºå…±äº«å…¨å±€å˜é‡å’Œå…¶ä»–å¤§éƒ¨åˆ†ä¸œè¥¿ã€‚

**çº¿ç¨‹è·Ÿåç¨‹çš„åŒºåˆ«**

- çº¿ç¨‹å¯ä»¥åŒæ—¶å¤šä¸ªè¿è¡Œ
- åç¨‹ä»»æ„æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªï¼Œå¹¶ä¸”å¤„äºè¿è¡ŒçŠ¶æ€çš„åç¨‹åªæœ‰è¢«æŒ‚èµ·ï¼ˆsuspendï¼‰æ—¶æ‰ä¼šæš‚åœã€‚

#### 8ã€userdataï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰
`userdata` æ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ– C/C++ è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ï¼Œå¯ä»¥å°†ä»»æ„ C/C++ çš„ä»»æ„æ•°æ®ç±»å‹çš„æ•°æ®ï¼ˆé€šå¸¸æ˜¯ `struct` å’Œ æŒ‡é’ˆï¼‰å­˜å‚¨åˆ° Lua å˜é‡ä¸­è°ƒç”¨ã€‚

